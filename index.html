<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="theme-color" content="#000000" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="description" content="GymMate - Tu compañero de entrenamiento personal. Tracking de volumen, PRs y progreso." />

  <title>GymMate - Tu Compañero de Entrenamiento</title>

  <!-- Favicons -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16.png" />

  <!-- Apple Touch Icons for iOS -->
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <meta name="apple-mobile-web-app-title" content="GymMate" />

  <!-- PWA Manifest is injected by vite-plugin-pwa -->

  <!-- Critical inline CSS for fallback -->
  <style>
    .hidden { display: none !important; }
    body { background-color: #000000; color: #f1f5f9; font-family: Inter, system-ui, sans-serif; }
    /* Skip Link - visible on focus */
    .skip-link {
      position: absolute;
      top: -100%;
      left: 50%;
      transform: translateX(-50%);
      background: #06b6d4;
      color: #0f172a;
      padding: 0.75rem 1.5rem;
      border-radius: 0 0 0.5rem 0.5rem;
      font-weight: 600;
      z-index: 9999;
      transition: top 0.2s;
    }
    .skip-link:focus {
      top: 0;
      outline: 3px solid #fff;
      outline-offset: 2px;
    }
  </style>
</head>
<body class="bg-dark-bg text-text-primary">

  <!-- Skip Link for keyboard navigation - WCAG 2.4.1 -->
  <a href="#main-content" class="skip-link">Saltar al contenido principal</a>

  <!-- Screen Reader Announcements - WCAG 4.1.3 -->
  <div id="srAnnouncements" class="sr-only" aria-live="polite" aria-atomic="true"></div>

  <!-- Indicador de cambios sin guardar -->
  <div id="unsavedIndicator" class="unsaved-indicator hidden" role="status" aria-live="polite">
    Cambios sin guardar
  </div>

  <!-- Timer Banner -->
  <div id="restTimerBanner" class="timer-banner" role="timer" aria-label="Temporizador de descanso">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-xs text-text-secondary" id="timerLabel">Descanso</p>
        <p id="timerDisplay" class="text-2xl font-bold text-accent font-display" aria-live="off">00:00</p>
      </div>
      <div class="flex gap-2">
        <button id="pauseTimer" class="px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-text-secondary text-sm flex items-center gap-1" aria-label="Pausar temporizador">
          <i data-lucide="pause" class="w-4 h-4" aria-hidden="true"></i>
          <span>Pausar</span>
        </button>
        <button id="stopTimer" class="px-3 py-2 bg-status-error/20 border border-status-error/30 rounded-lg text-status-error text-sm" aria-label="Detener temporizador">
          <i data-lucide="x" class="w-4 h-4" aria-hidden="true"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Main Container -->
  <main id="main-content" class="px-5 pt-6 pb-28" role="main" tabindex="-1">

    <!-- ==========================================
         HOME VIEW
         ========================================== -->
    <div id="homeView" role="region" aria-label="Página principal">
      <!-- Hero Section - Dynamic content rendered by JS -->
      <section class="mb-6" aria-labelledby="hero-title">
        <div id="heroContent">
          <!-- Placeholder - Will be replaced by updateHeroSection() -->
          <div class="bg-dark-surface border border-dark-border rounded-2xl p-5 relative overflow-hidden">
            <div class="absolute top-0 right-0 w-32 h-32 bg-accent/10 rounded-full blur-3xl opacity-50 -translate-y-1/2 translate-x-1/2" aria-hidden="true"></div>
            <div class="relative">
              <p class="text-sm text-text-muted mb-1">Hola</p>
              <h1 id="hero-title" class="text-2xl font-display font-bold text-text-primary mb-3">GymMate</h1>
              <div class="inline-flex items-center gap-2 px-3 py-1.5 bg-accent/10 rounded-full">
                <i data-lucide="zap" class="w-4 h-4 text-accent" aria-hidden="true"></i>
                <span class="text-sm font-medium text-accent">Cargando...</span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Resume Workout Card -->
      <div id="resumeWorkoutCard" class="hidden" role="region" aria-label="Continuar entrenamiento"></div>

      <!-- Quick Actions - Vibrant and energetic -->
      <section class="mb-6" aria-labelledby="quick-actions-title">
        <h2 id="quick-actions-title" class="text-sm font-bold text-white uppercase tracking-wide mb-4 flex items-center gap-2">
          <span class="w-1 h-4 bg-gradient-to-b from-cyan-400 to-blue-500 rounded-full" aria-hidden="true"></span>
          Acceso Rápido
        </h2>
        <div class="grid grid-cols-4 gap-3" role="group" aria-label="Accesos directos">
          <button data-action="calculators" class="bg-gradient-to-br from-blue-500/20 to-indigo-600/10 border border-blue-500/30 rounded-2xl p-4 flex flex-col items-center gap-2 active:scale-95 transition-transform min-h-[80px] hover:border-blue-400/50 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-offset-2 focus:ring-offset-dark-bg" aria-label="Abrir calculadoras">
            <div class="w-11 h-11 rounded-xl bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center shadow-lg shadow-blue-500/30" aria-hidden="true">
              <i data-lucide="calculator" class="w-5 h-5 text-white" aria-hidden="true"></i>
            </div>
            <span class="text-xs text-blue-300 font-semibold">Calc</span>
          </button>
          <button data-action="history" class="bg-gradient-to-br from-purple-500/20 to-violet-600/10 border border-purple-500/30 rounded-2xl p-4 flex flex-col items-center gap-2 active:scale-95 transition-transform min-h-[80px] hover:border-purple-400/50 focus:outline-none focus:ring-2 focus:ring-purple-400 focus:ring-offset-2 focus:ring-offset-dark-bg" aria-label="Ver historial de entrenamientos">
            <div class="w-11 h-11 rounded-xl bg-gradient-to-br from-purple-500 to-violet-600 flex items-center justify-center shadow-lg shadow-purple-500/30" aria-hidden="true">
              <i data-lucide="history" class="w-5 h-5 text-white" aria-hidden="true"></i>
            </div>
            <span class="text-xs text-purple-300 font-semibold">Historial</span>
          </button>
          <button data-action="charts" class="bg-gradient-to-br from-emerald-500/20 to-green-600/10 border border-emerald-500/30 rounded-2xl p-4 flex flex-col items-center gap-2 active:scale-95 transition-transform min-h-[80px] hover:border-emerald-400/50 focus:outline-none focus:ring-2 focus:ring-emerald-400 focus:ring-offset-2 focus:ring-offset-dark-bg" aria-label="Ver gráficos de progreso">
            <div class="w-11 h-11 rounded-xl bg-gradient-to-br from-emerald-500 to-green-600 flex items-center justify-center shadow-lg shadow-emerald-500/30" aria-hidden="true">
              <i data-lucide="line-chart" class="w-5 h-5 text-white" aria-hidden="true"></i>
            </div>
            <span class="text-xs text-emerald-300 font-semibold">Gráficos</span>
          </button>
          <button data-action="prs" class="bg-gradient-to-br from-yellow-500/20 to-orange-600/10 border border-yellow-500/30 rounded-2xl p-4 flex flex-col items-center gap-2 active:scale-95 transition-transform min-h-[80px] hover:border-yellow-400/50 focus:outline-none focus:ring-2 focus:ring-yellow-400 focus:ring-offset-2 focus:ring-offset-dark-bg" aria-label="Ver récords personales">
            <div class="w-11 h-11 rounded-xl bg-gradient-to-br from-yellow-500 to-orange-600 flex items-center justify-center shadow-lg shadow-yellow-500/30" aria-hidden="true">
              <i data-lucide="trophy" class="w-5 h-5 text-white" aria-hidden="true"></i>
            </div>
            <span class="text-xs text-yellow-300 font-semibold">PRs</span>
          </button>
        </div>
      </section>

      <!-- Rutinas -->
      <section class="mb-8" aria-labelledby="routines-title">
        <h2 id="routines-title" class="text-base font-display font-bold text-white mb-4 flex items-center gap-2">
          <span class="w-1 h-5 bg-gradient-to-b from-pink-500 to-purple-600 rounded-full" aria-hidden="true"></span>
          <i data-lucide="dumbbell" class="w-5 h-5 text-pink-400" aria-hidden="true"></i>
          Rutinas Disponibles
        </h2>
        <div id="routinesContainer" class="space-y-3" role="list" aria-label="Lista de rutinas de entrenamiento">
          <!-- Se renderiza dinámicamente -->
        </div>
      </section>

      <!-- Custom Workouts -->
      <div id="customWorkoutsContainer" role="region" aria-label="Rutinas personalizadas"></div>

      <!-- Cardio Section -->
      <section class="mt-8" aria-label="Sección de cardio">
        <button onclick="window.showCardioSelector()" class="w-full bg-gradient-to-r from-orange-600/20 via-red-600/15 to-pink-600/20 border border-orange-500/40 rounded-2xl p-5 flex items-center gap-4 active:scale-[0.98] transition-transform min-h-[80px] hover:border-orange-400/60 focus:outline-none focus:ring-2 focus:ring-orange-400 focus:ring-offset-2 focus:ring-offset-dark-bg" aria-label="Abrir sección de Cardio y HIIT: Tabata, EMOM, AMRAP y más">
          <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-orange-500 to-red-600 flex items-center justify-center flex-shrink-0 shadow-lg shadow-orange-500/40" aria-hidden="true">
            <i data-lucide="flame" class="w-7 h-7 text-white" aria-hidden="true"></i>
          </div>
          <div class="flex-1 text-left min-w-0">
            <h3 class="font-bold text-white text-base">Cardio & HIIT</h3>
            <p class="text-sm text-orange-200/80 mt-1">Tabata, EMOM, AMRAP y más</p>
          </div>
          <div class="w-10 h-10 flex items-center justify-center flex-shrink-0" aria-hidden="true">
            <i data-lucide="chevron-right" class="w-5 h-5 text-orange-300" aria-hidden="true"></i>
          </div>
        </button>
      </section>
    </div>

    <!-- ==========================================
         WORKOUT TAB
         ========================================== -->
    <div id="workoutTab" class="tab-content hidden" role="region" aria-label="Sesión de entrenamiento">
      <!-- Header with Back Button -->
      <div id="trainingInfo" class="mb-6 hidden">
        <!-- Navigation Bar -->
        <div class="flex items-center gap-3 mb-4">
          <button onclick="window.showHome()" class="w-11 h-11 flex items-center justify-center bg-dark-surface border border-dark-border rounded-xl active:scale-95 transition-transform focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-2 focus:ring-offset-dark-bg" aria-label="Volver al inicio">
            <i data-lucide="arrow-left" class="w-5 h-5 text-text-primary" aria-hidden="true"></i>
          </button>
          <div class="flex-1 min-w-0">
            <h1 id="currentTraining" class="text-lg font-bold text-text-primary truncate"></h1>
            <p id="currentDate" class="text-sm text-text-secondary"></p>
          </div>
          <button onclick="window.openRestTimerModal()" class="w-11 h-11 flex items-center justify-center bg-dark-surface border border-dark-border rounded-xl active:scale-95 transition-transform focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-2 focus:ring-offset-dark-bg" aria-label="Abrir temporizador de descanso">
            <i data-lucide="timer" class="w-5 h-5 text-accent" aria-hidden="true"></i>
          </button>
        </div>

        <!-- Instructions Banner -->
        <div class="bg-accent/10 border border-accent/20 rounded-xl p-4 mb-4" role="note">
          <p class="text-sm text-accent font-medium flex items-center gap-2">
            <i data-lucide="info" class="w-4 h-4 flex-shrink-0" aria-hidden="true"></i>
            <span>Ingresa sets, reps y peso para cada ejercicio. Marca completado cuando termines.</span>
          </p>
        </div>
      </div>

      <!-- Quick Stats -->
      <div id="quickStats" class="hidden mb-6" role="region" aria-label="Estadísticas de la sesión">
        <div class="grid grid-cols-2 gap-3">
          <div class="bg-dark-surface border border-dark-border rounded-2xl p-4">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 rounded-xl bg-accent/10 flex items-center justify-center" aria-hidden="true">
                <i data-lucide="trending-up" class="w-5 h-5 text-accent" aria-hidden="true"></i>
              </div>
              <div>
                <p id="statVolumen" class="text-xl font-bold text-accent" aria-label="Volumen total">0</p>
                <p class="text-xs text-text-muted">Volumen (kg)</p>
              </div>
            </div>
          </div>
          <div class="bg-dark-surface border border-dark-border rounded-2xl p-4">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 rounded-xl bg-status-success/10 flex items-center justify-center" aria-hidden="true">
                <i data-lucide="check-circle" class="w-5 h-5 text-status-success" aria-hidden="true"></i>
              </div>
              <div>
                <p id="statCompletados" class="text-xl font-bold text-status-success" aria-label="Ejercicios completados">0/0</p>
                <p class="text-xs text-text-muted">Completados</p>
              </div>
            </div>
          </div>
          <div class="bg-dark-surface border border-dark-border rounded-2xl p-4">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 rounded-xl bg-status-warning/10 flex items-center justify-center" aria-hidden="true">
                <i data-lucide="dumbbell" class="w-5 h-5 text-status-warning" aria-hidden="true"></i>
              </div>
              <div>
                <p id="statEjercicios" class="text-xl font-bold text-status-warning" aria-label="Número de ejercicios">0</p>
                <p class="text-xs text-text-muted">Ejercicios</p>
              </div>
            </div>
          </div>
          <div class="bg-dark-surface border border-dark-border rounded-2xl p-4">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 rounded-xl bg-status-info/10 flex items-center justify-center" aria-hidden="true">
                <i data-lucide="layers" class="w-5 h-5 text-status-info" aria-hidden="true"></i>
              </div>
              <div>
                <p id="statSets" class="text-xl font-bold text-status-info" aria-label="Sets totales">0</p>
                <p class="text-xs text-text-muted">Sets totales</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Ejercicios Section -->
      <div id="ejerciciosContainer" class="hidden">
        <h2 class="text-base font-semibold text-text-primary mb-4 flex items-center gap-2">
          <i data-lucide="list-checks" class="w-5 h-5 text-accent" aria-hidden="true"></i>
          Ejercicios del Día
        </h2>
        <div id="ejerciciosList" class="space-y-4" role="list" aria-label="Lista de ejercicios"></div>
        <div id="opcionalesList" class="mt-6" role="list" aria-label="Ejercicios opcionales"></div>
      </div>

      <!-- Volume Summary -->
      <div id="volumeSummary" class="hidden mt-6">
        <div class="bg-dark-surface border border-dark-border rounded-2xl p-5">
          <h3 class="text-base font-semibold text-text-primary mb-4 flex items-center gap-2">
            <i data-lucide="bar-chart-3" class="w-5 h-5 text-accent" aria-hidden="true"></i>
            Resumen de Volumen
          </h3>
          <div id="volumeBars" role="img" aria-label="Gráfico de barras de volumen por grupo muscular"></div>
        </div>
      </div>

      <!-- Save Section -->
      <div id="saveSection" class="hidden mt-6 space-y-4">
        <button id="saveButton" onclick="window.saveWorkout()" class="w-full bg-accent hover:bg-accent-hover text-white font-semibold py-4 px-6 rounded-2xl active:scale-95 transition-all flex items-center justify-center gap-3 text-base min-h-[56px] focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-accent" aria-label="Guardar entrenamiento actual">
          <i data-lucide="save" class="w-6 h-6" aria-hidden="true"></i>
          Guardar Entrenamiento
        </button>
        <button onclick="window.finishWorkout()" class="w-full bg-dark-surface border border-dark-border text-text-secondary font-semibold py-4 px-6 rounded-2xl active:scale-95 transition-all flex items-center justify-center gap-3 text-base min-h-[56px] focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-2 focus:ring-offset-dark-bg" aria-label="Terminar sesión sin guardar">
          <i data-lucide="log-out" class="w-5 h-5" aria-hidden="true"></i>
          Terminar Sesión
        </button>
        <p id="saveMessage" class="hidden text-center text-sm text-status-success py-3" role="status" aria-live="polite"></p>
      </div>
    </div>

    <!-- ==========================================
         CALCULATORS TAB
         ========================================== -->
    <div id="calculatorsTab" class="tab-content hidden" role="region" aria-label="Calculadoras de fitness">
      <!-- Navigation Bar -->
      <div class="flex items-center gap-3 mb-6">
        <button onclick="window.showHome()" class="w-11 h-11 flex items-center justify-center bg-dark-surface border border-dark-border rounded-xl active:scale-95 transition-transform focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-2 focus:ring-offset-dark-bg" aria-label="Volver al inicio">
          <i data-lucide="arrow-left" class="w-5 h-5 text-text-primary" aria-hidden="true"></i>
        </button>
        <h1 class="text-xl font-display font-bold text-text-primary flex items-center gap-2">
          <i data-lucide="calculator" class="w-6 h-6 text-accent" aria-hidden="true"></i>
          Calculadoras
        </h1>
      </div>

      <!-- 1RM Calculator -->
      <fieldset class="bg-dark-surface border border-dark-border rounded-xl p-4 mb-4">
        <legend class="sr-only">Calculadora de 1RM</legend>
        <h2 class="text-sm font-semibold text-text-primary mb-3 flex items-center gap-2">
          <i data-lucide="dumbbell" class="w-4 h-4 text-accent" aria-hidden="true"></i>
          Calculadora de 1RM
        </h2>
        <label for="rm1ExerciseSelect" class="sr-only">Seleccionar ejercicio para calcular 1RM</label>
        <select id="rm1ExerciseSelect" class="w-full mb-3" aria-describedby="rm1Description">
          <option value="">-- Elige un ejercicio --</option>
        </select>
        <p id="rm1Description" class="sr-only">Selecciona un ejercicio para ver tu repetición máxima estimada</p>
        <div id="rm1Results" class="hidden" role="region" aria-live="polite" aria-label="Resultados de 1RM"></div>
      </fieldset>

      <!-- Calories Calculator -->
      <fieldset class="bg-dark-surface border border-dark-border rounded-xl p-4 mb-4 overflow-hidden">
        <legend class="sr-only">Calculadora de Calorías</legend>
        <h2 class="text-sm font-semibold text-text-primary mb-3 flex items-center gap-2">
          <i data-lucide="flame" class="w-4 h-4 text-status-warning" aria-hidden="true"></i>
          Calculadora de Calorías
        </h2>
        <div class="space-y-3">
          <div class="grid grid-cols-2 gap-2">
            <div>
              <label for="caloriesAge" class="sr-only">Edad</label>
              <input type="number" id="caloriesAge" placeholder="Edad" class="w-full" aria-label="Tu edad en años" />
            </div>
            <div>
              <label for="caloriesGender" class="sr-only">Género</label>
              <select id="caloriesGender" class="w-full" aria-label="Tu género">
                <option value="male">Masculino</option>
                <option value="female">Femenino</option>
              </select>
            </div>
          </div>
          <div class="grid grid-cols-2 gap-2">
            <div>
              <label for="caloriesWeight" class="sr-only">Peso en kilogramos</label>
              <input type="number" id="caloriesWeight" placeholder="Peso (kg)" class="w-full" aria-label="Tu peso en kilogramos" />
            </div>
            <div>
              <label for="caloriesHeight" class="sr-only">Altura en centímetros</label>
              <input type="number" id="caloriesHeight" placeholder="Altura (cm)" class="w-full" aria-label="Tu altura en centímetros" />
            </div>
          </div>
          <div>
            <label for="caloriesActivity" class="sr-only">Nivel de actividad física</label>
            <select id="caloriesActivity" class="w-full text-sm" aria-label="Tu nivel de actividad física">
              <option value="1.2">Sedentario</option>
              <option value="1.375">Ligero (1-3 días/sem)</option>
              <option value="1.55">Moderado (3-5 días/sem)</option>
              <option value="1.725">Activo (6-7 días/sem)</option>
              <option value="1.9">Muy activo (atleta)</option>
            </select>
          </div>
          <div class="grid grid-cols-2 gap-2">
            <button id="prefillFromProfile" class="w-full py-2.5 px-3 bg-dark-bg border border-dark-border rounded-lg text-text-secondary text-sm active:scale-95 transition-all flex items-center justify-center gap-2 focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-2 focus:ring-offset-dark-surface" aria-label="Cargar datos desde mi perfil">
              <i data-lucide="user" class="w-4 h-4" aria-hidden="true"></i>
              Perfil
            </button>
            <button id="calculateCaloriesBtn" class="w-full py-2.5 px-3 bg-accent text-white rounded-lg font-semibold text-sm active:scale-95 transition-all focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-accent" aria-label="Calcular calorías diarias recomendadas">
              Calcular
            </button>
          </div>
        </div>
        <div id="caloriesResults" class="hidden mt-4" role="region" aria-live="polite" aria-label="Resultados de calorías"></div>
      </fieldset>

      <!-- Progressive Calculator -->
      <fieldset class="bg-dark-surface border border-dark-border rounded-xl p-4">
        <legend class="sr-only">Calculadora de Peso Progresivo</legend>
        <h2 class="text-sm font-semibold text-text-primary mb-3 flex items-center gap-2">
          <i data-lucide="trending-up" class="w-4 h-4 text-status-success" aria-hidden="true"></i>
          Peso Progresivo
        </h2>
        <label for="progressiveExerciseSelect" class="sr-only">Seleccionar ejercicio para progresión</label>
        <select id="progressiveExerciseSelect" class="w-full mb-3" aria-describedby="progressiveDescription">
          <option value="">-- Elige un ejercicio --</option>
        </select>
        <p id="progressiveDescription" class="sr-only">Selecciona un ejercicio para ver sugerencias de progresión de peso</p>
        <div id="progressiveResults" class="hidden" role="region" aria-live="polite" aria-label="Resultados de progresión"></div>
      </fieldset>
    </div>

    <!-- ==========================================
         CHARTS TAB
         ========================================== -->
    <div id="chartsTab" class="tab-content hidden" role="region" aria-label="Gráficos de progreso">
      <!-- Navigation Bar -->
      <div class="flex items-center gap-3 mb-6">
        <button onclick="window.showHome()" class="w-11 h-11 flex items-center justify-center bg-dark-surface border border-dark-border rounded-xl active:scale-95 transition-transform focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-2 focus:ring-offset-dark-bg" aria-label="Volver al inicio">
          <i data-lucide="arrow-left" class="w-5 h-5 text-text-primary" aria-hidden="true"></i>
        </button>
        <h1 class="text-xl font-display font-bold text-text-primary flex items-center gap-2">
          <i data-lucide="line-chart" class="w-6 h-6 text-green-400" aria-hidden="true"></i>
          Progreso
        </h1>
      </div>

      <!-- Volume Trend -->
      <div class="bg-dark-surface border border-dark-border rounded-xl p-4 mb-4">
        <h2 class="text-sm font-semibold text-text-primary mb-3">Tendencia de Volumen</h2>
        <div class="h-48" role="img" aria-label="Gráfico de tendencia de volumen de entrenamiento">
          <canvas id="volumeTrendChart" aria-label="Gráfico de líneas mostrando la tendencia de volumen"></canvas>
        </div>
      </div>

      <!-- Muscle Distribution -->
      <div class="bg-dark-surface border border-dark-border rounded-xl p-4 mb-4">
        <h2 class="text-sm font-semibold text-text-primary mb-3">Distribución Muscular</h2>
        <div class="h-48" role="img" aria-label="Gráfico de distribución de trabajo por grupo muscular">
          <canvas id="muscleDistributionChart" aria-label="Gráfico circular de distribución muscular"></canvas>
        </div>
      </div>

      <!-- Weight Progress -->
      <div class="bg-dark-surface border border-dark-border rounded-xl p-4 mb-4">
        <h2 class="text-sm font-semibold text-text-primary mb-3">Progreso por Ejercicio</h2>
        <label for="exerciseChartSelect" class="sr-only">Seleccionar ejercicio para ver progreso</label>
        <select id="exerciseChartSelect" class="w-full mb-3" aria-label="Seleccionar ejercicio para ver gráfico de progreso">
          <option value="">-- Elige un ejercicio --</option>
        </select>
        <div class="h-48" role="img" aria-label="Gráfico de progreso de peso por ejercicio">
          <canvas id="weightProgressChart" aria-label="Gráfico de progreso de peso"></canvas>
        </div>
      </div>

      <!-- Weekly Comparison -->
      <div class="bg-dark-surface border border-dark-border rounded-xl p-4">
        <h2 class="text-sm font-semibold text-text-primary mb-3">Volumen Semanal</h2>
        <div class="h-48" role="img" aria-label="Gráfico de comparación de volumen semanal">
          <canvas id="weeklyComparisonChart" aria-label="Gráfico de barras de volumen semanal"></canvas>
        </div>
      </div>
    </div>

    <!-- ==========================================
         HISTORY TAB
         ========================================== -->
    <div id="historyTab" class="tab-content hidden" role="region" aria-label="Historial de entrenamientos">
      <!-- Navigation Bar -->
      <div class="flex items-center gap-3 mb-6">
        <button onclick="window.showHome()" class="w-11 h-11 flex items-center justify-center bg-dark-surface border border-dark-border rounded-xl active:scale-95 transition-transform focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-2 focus:ring-offset-dark-bg" aria-label="Volver al inicio">
          <i data-lucide="arrow-left" class="w-5 h-5 text-text-primary" aria-hidden="true"></i>
        </button>
        <h1 class="flex-1 text-xl font-display font-bold text-text-primary flex items-center gap-2">
          <i data-lucide="history" class="w-6 h-6 text-purple-400" aria-hidden="true"></i>
          Historial
        </h1>
        <button onclick="window.exportToExcel()" class="px-3 py-2 bg-dark-surface border border-dark-border rounded-lg text-text-secondary text-sm active:scale-95 transition-all flex items-center gap-2 focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-2 focus:ring-offset-dark-bg" aria-label="Exportar historial a archivo CSV">
          <i data-lucide="download" class="w-4 h-4" aria-hidden="true"></i>
          Exportar
        </button>
      </div>
      <div id="historyList" class="space-y-3" role="list" aria-label="Lista de entrenamientos anteriores"></div>
    </div>

    <!-- ==========================================
         PRS TAB
         ========================================== -->
    <div id="prsTab" class="tab-content hidden" role="region" aria-label="Récords personales">
      <!-- Navigation Bar -->
      <div class="flex items-center gap-3 mb-6">
        <button onclick="window.showHome()" class="w-11 h-11 flex items-center justify-center bg-dark-surface border border-dark-border rounded-xl active:scale-95 transition-transform focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-2 focus:ring-offset-dark-bg" aria-label="Volver al inicio">
          <i data-lucide="arrow-left" class="w-5 h-5 text-text-primary" aria-hidden="true"></i>
        </button>
        <h1 class="text-xl font-display font-bold text-text-primary flex items-center gap-2">
          <i data-lucide="trophy" class="w-6 h-6 text-yellow-400" aria-hidden="true"></i>
          Personal Records
        </h1>
      </div>
      <div id="prsList" class="space-y-3" role="list" aria-label="Lista de récords personales"></div>
    </div>

    <!-- ==========================================
         PROFILE TAB
         ========================================== -->
    <div id="profileTab" class="tab-content hidden" role="region" aria-label="Perfil de usuario">
      <!-- Navigation Bar -->
      <div class="flex items-center gap-3 mb-6">
        <button onclick="window.showHome()" class="w-11 h-11 flex items-center justify-center bg-dark-surface border border-dark-border rounded-xl active:scale-95 transition-transform focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-2 focus:ring-offset-dark-bg" aria-label="Volver al inicio">
          <i data-lucide="arrow-left" class="w-5 h-5 text-text-primary" aria-hidden="true"></i>
        </button>
        <h1 class="text-xl font-display font-bold text-text-primary flex items-center gap-2">
          <i data-lucide="user" class="w-6 h-6 text-accent" aria-hidden="true"></i>
          Mi Perfil
        </h1>
      </div>

      <form id="profileForm" class="bg-dark-surface border border-dark-border rounded-xl p-4 overflow-hidden" aria-label="Formulario de perfil">
        <div class="space-y-4">
          <div>
            <label for="profileName" class="block text-sm text-text-secondary mb-1">Nombre</label>
            <input type="text" id="profileName" placeholder="Tu nombre" class="w-full" autocomplete="name" />
          </div>
          <div class="overflow-hidden">
            <label for="profileBirthdate" class="block text-sm text-text-secondary mb-1">Fecha de nacimiento</label>
            <input type="date" id="profileBirthdate" class="w-full max-w-full" autocomplete="bday" />
            <p class="text-xs text-text-muted mt-1" aria-live="polite">Edad: <span id="calculatedAge">-</span> años</p>
          </div>
          <div>
            <label for="profileGender" class="block text-sm text-text-secondary mb-1">Género</label>
            <select id="profileGender" class="w-full" autocomplete="sex">
              <option value="male">Masculino</option>
              <option value="female">Femenino</option>
            </select>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div>
              <label for="profileWeight" class="block text-sm text-text-secondary mb-1">Peso (kg)</label>
              <input type="number" id="profileWeight" placeholder="70" class="w-full" inputmode="decimal" />
            </div>
            <div>
              <label for="profileHeight" class="block text-sm text-text-secondary mb-1">Altura (cm)</label>
              <input type="number" id="profileHeight" placeholder="175" class="w-full" inputmode="decimal" />
            </div>
          </div>
          <div>
            <label for="profileActivity" class="block text-sm text-text-secondary mb-1">Nivel de actividad</label>
            <select id="profileActivity" class="w-full">
              <option value="1.2">Sedentario</option>
              <option value="1.375">Ligero (1-3 días/semana)</option>
              <option value="1.55">Moderado (3-5 días/semana)</option>
              <option value="1.725">Activo (6-7 días/semana)</option>
              <option value="1.9">Muy activo</option>
            </select>
          </div>
          <button type="submit" class="w-full bg-accent hover:bg-accent-hover text-white font-semibold py-3 px-4 rounded-xl active:scale-95 transition-all flex items-center justify-center gap-2 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-accent" aria-label="Guardar cambios en el perfil">
            <i data-lucide="save" class="w-5 h-5" aria-hidden="true"></i>
            Guardar Perfil
          </button>
          <p id="profileSaveMessage" class="hidden text-center text-sm text-status-success py-2" role="status" aria-live="polite">
            Perfil guardado correctamente
          </p>
        </div>
      </form>
    </div>

    <!-- ==========================================
         CARDIO VIEWS
         ========================================== -->

    <!-- Cardio Selector View -->
    <div id="cardioSelectorView" class="hidden" role="region" aria-label="Selección de modo cardio">
      <!-- Rendered dynamically by cardio.ts -->
    </div>

    <!-- Cardio Config View -->
    <div id="cardioConfigView" class="hidden" role="region" aria-label="Configuración de cardio">
      <!-- Rendered dynamically by cardio.ts -->
    </div>

    <!-- Cardio Timer View -->
    <div id="cardioTimerView" class="hidden" role="region" aria-label="Temporizador de cardio">
      <!-- Rendered dynamically by cardio.ts -->
    </div>

    <!-- Cardio Summary View -->
    <div id="cardioSummaryView" class="hidden" role="region" aria-label="Resumen de cardio">
      <!-- Rendered dynamically by cardio.ts -->
    </div>

  </main>

  <!-- ==========================================
       BOTTOM NAVIGATION
       ========================================== -->
  <nav class="bottom-nav" role="navigation" aria-label="Navegación principal">
    <div class="flex items-center justify-around">
      <button data-nav="home" class="bottom-nav-item active" role="tab" aria-selected="true" aria-label="Ir a inicio" tabindex="0">
        <i data-lucide="home" class="w-5 h-5" aria-hidden="true"></i>
        <span>Inicio</span>
      </button>
      <button data-nav="calculators" class="bottom-nav-item" role="tab" aria-selected="false" aria-label="Ir a calculadoras" tabindex="-1">
        <i data-lucide="calculator" class="w-5 h-5" aria-hidden="true"></i>
        <span>Calc</span>
      </button>
      <button id="fabButton" class="fab-button" aria-label="Crear nueva rutina o iniciar entrenamiento" aria-haspopup="true">
        <i data-lucide="plus" class="w-6 h-6 text-white" aria-hidden="true"></i>
      </button>
      <button data-nav="history" class="bottom-nav-item" role="tab" aria-selected="false" aria-label="Ir a historial" tabindex="-1">
        <i data-lucide="history" class="w-5 h-5" aria-hidden="true"></i>
        <span>Historial</span>
      </button>
      <button data-nav="profile" class="bottom-nav-item" role="tab" aria-selected="false" aria-label="Ir a mi perfil" tabindex="-1">
        <i data-lucide="user" class="w-5 h-5" aria-hidden="true"></i>
        <span>Perfil</span>
      </button>
    </div>
  </nav>

  <!-- ==========================================
       MODALS
       ========================================== -->

  <!-- Animation Modal -->
  <div id="animationModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" aria-hidden="true">
    <div class="modal-content p-4">
      <div class="flex items-center justify-between mb-4">
        <h2 id="modalTitle" class="font-bold text-text-primary"></h2>
        <button id="closeModal" class="p-2 text-text-muted hover:text-text-primary focus:outline-none focus:ring-2 focus:ring-accent rounded-lg" aria-label="Cerrar modal">
          <i data-lucide="x" class="w-5 h-5" aria-hidden="true"></i>
        </button>
      </div>
      <div id="animationContainer" class="flex items-center justify-center min-h-[200px]">
        <p class="text-text-secondary">Cargando imagen de referencia...</p>
      </div>
    </div>
  </div>

  <!-- Rest Timer Modal -->
  <div id="restTimerModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="restTimerModalTitle" aria-hidden="true">
    <div class="modal-content p-4">
      <div class="flex items-center justify-between mb-4">
        <h2 id="restTimerModalTitle" class="font-bold text-text-primary flex items-center gap-2">
          <i data-lucide="timer" class="w-5 h-5 text-accent" aria-hidden="true"></i>
          Tiempo de Descanso
        </h2>
        <button id="closeRestModal" class="p-2 text-text-muted hover:text-text-primary focus:outline-none focus:ring-2 focus:ring-accent rounded-lg" aria-label="Cerrar modal de temporizador">
          <i data-lucide="x" class="w-5 h-5" aria-hidden="true"></i>
        </button>
      </div>
      <div class="grid grid-cols-3 gap-3" role="group" aria-label="Opciones de tiempo de descanso">
        <button data-seconds="30" class="rest-time-btn py-4 bg-dark-bg border border-dark-border rounded-xl text-center active:scale-95 transition-transform focus:outline-none focus:ring-2 focus:ring-accent" aria-label="Iniciar descanso de 30 segundos">
          <p class="text-xl font-bold text-accent">30s</p>
          <p class="text-xs text-text-muted">Rápido</p>
        </button>
        <button data-seconds="60" class="rest-time-btn py-4 bg-dark-bg border border-dark-border rounded-xl text-center active:scale-95 transition-transform focus:outline-none focus:ring-2 focus:ring-accent" aria-label="Iniciar descanso de 1 minuto">
          <p class="text-xl font-bold text-accent">1:00</p>
          <p class="text-xs text-text-muted">Normal</p>
        </button>
        <button data-seconds="90" class="rest-time-btn py-4 bg-dark-bg border border-dark-border rounded-xl text-center active:scale-95 transition-transform focus:outline-none focus:ring-2 focus:ring-accent" aria-label="Iniciar descanso de 1 minuto y 30 segundos">
          <p class="text-xl font-bold text-accent">1:30</p>
          <p class="text-xs text-text-muted">Largo</p>
        </button>
        <button data-seconds="120" class="rest-time-btn py-4 bg-dark-bg border border-dark-border rounded-xl text-center active:scale-95 transition-transform focus:outline-none focus:ring-2 focus:ring-accent" aria-label="Iniciar descanso de 2 minutos">
          <p class="text-xl font-bold text-accent">2:00</p>
          <p class="text-xs text-text-muted">Pesado</p>
        </button>
        <button data-seconds="180" class="rest-time-btn py-4 bg-dark-bg border border-dark-border rounded-xl text-center active:scale-95 transition-transform focus:outline-none focus:ring-2 focus:ring-accent" aria-label="Iniciar descanso de 3 minutos">
          <p class="text-xl font-bold text-accent">3:00</p>
          <p class="text-xs text-text-muted">Fuerza</p>
        </button>
        <button data-seconds="300" class="rest-time-btn py-4 bg-dark-bg border border-dark-border rounded-xl text-center active:scale-95 transition-transform focus:outline-none focus:ring-2 focus:ring-accent" aria-label="Iniciar descanso de 5 minutos">
          <p class="text-xl font-bold text-accent">5:00</p>
          <p class="text-xs text-text-muted">Máximo</p>
        </button>
      </div>
    </div>
  </div>

  <!-- Workout Builder Modal -->
  <div id="workoutBuilderModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="workoutBuilderTitle" aria-hidden="true">
    <div class="modal-content max-h-[90vh] overflow-hidden flex flex-col">
      <div class="flex items-center justify-between p-4 border-b border-dark-border">
        <h2 id="workoutBuilderTitle" class="font-bold text-text-primary flex items-center gap-2">
          <i data-lucide="plus-circle" class="w-5 h-5 text-accent" aria-hidden="true"></i>
          Nueva Rutina
        </h2>
        <button onclick="window.closeWorkoutBuilder()" class="p-2 text-text-muted hover:text-text-primary focus:outline-none focus:ring-2 focus:ring-accent rounded-lg" aria-label="Cerrar creador de rutinas">
          <i data-lucide="x" class="w-5 h-5" aria-hidden="true"></i>
        </button>
      </div>

      <div class="flex-1 overflow-y-auto p-4">
        <!-- Workout Name -->
        <div class="mb-4">
          <label for="customWorkoutName" class="block text-sm text-text-secondary mb-2">Nombre de la rutina</label>
          <input type="text" id="customWorkoutName" placeholder="Ej: Mi rutina de piernas" class="w-full" aria-required="true" />
        </div>

        <!-- Selected Exercises -->
        <div class="mb-4">
          <p class="block text-sm text-text-secondary mb-2" id="selectedExercisesLabel">Ejercicios seleccionados (<span id="selectedCount">0</span>)</p>
          <div id="selectedExercisesList" class="min-h-[60px] bg-dark-bg border border-dark-border rounded-xl p-3" role="list" aria-labelledby="selectedExercisesLabel" aria-live="polite">
            <p class="text-text-muted text-sm text-center">Selecciona ejercicios de la lista</p>
          </div>
        </div>

        <!-- Exercise List by Group -->
        <div>
          <p class="block text-sm text-text-secondary mb-2" id="availableExercisesLabel">Ejercicios disponibles</p>
          <div id="exerciseGroupsList" class="space-y-3" role="group" aria-labelledby="availableExercisesLabel">
            <!-- Se renderiza dinámicamente -->
          </div>
        </div>
      </div>

      <!-- Save Button -->
      <div class="p-4 border-t border-dark-border">
        <button onclick="window.saveCustomWorkout()" class="w-full bg-accent hover:bg-accent-hover text-white font-semibold py-3 px-4 rounded-xl active:scale-95 transition-all flex items-center justify-center gap-2 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-accent" aria-label="Guardar nueva rutina personalizada">
          <i data-lucide="save" class="w-5 h-5" aria-hidden="true"></i>
          Guardar Rutina
        </button>
      </div>
    </div>
  </div>

  <script type="module" src="/src/main.ts"></script>
</body>
</html>
