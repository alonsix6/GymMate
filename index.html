<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="theme-color" content="#0f172a" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="description" content="GymMate - Tu compañero de entrenamiento personal. Tracking de volumen, PRs y progreso." />

  <title>GymMate - Tu Compañero de Entrenamiento</title>

  <link rel="icon" type="image/png" sizes="192x192" href="/icon-192.png" />
  <link rel="apple-touch-icon" href="/icon-192.png" />
  <link rel="manifest" href="/manifest.json" />
</head>
<body class="bg-dark-bg text-text-primary">

  <!-- Indicador de cambios sin guardar -->
  <div id="unsavedIndicator" class="unsaved-indicator hidden">
    Cambios sin guardar
  </div>

  <!-- Timer Banner -->
  <div id="restTimerBanner" class="timer-banner">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-xs text-text-secondary">Descanso</p>
        <p id="timerDisplay" class="text-2xl font-bold text-accent font-display">00:00</p>
      </div>
      <div class="flex gap-2">
        <button id="pauseTimer" class="px-3 py-2 bg-dark-bg border border-dark-border rounded-lg text-text-secondary text-sm flex items-center gap-1">
          <i data-lucide="pause" class="w-4 h-4"></i>
          <span>Pausar</span>
        </button>
        <button id="stopTimer" class="px-3 py-2 bg-status-error/20 border border-status-error/30 rounded-lg text-status-error text-sm">
          <i data-lucide="x" class="w-4 h-4"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Main Container -->
  <main class="p-4 pb-24">

    <!-- ==========================================
         HOME VIEW
         ========================================== -->
    <div id="homeView">
      <!-- Hero Section -->
      <section class="mb-6">
        <div id="heroContent" class="py-4">
          <div class="flex items-center gap-3 mb-2">
            <i data-lucide="dumbbell" class="w-8 h-8 text-accent"></i>
            <h1 class="text-2xl font-display font-bold text-text-primary">Bienvenido a GymMate</h1>
          </div>
          <p class="text-text-secondary">Tu compañero de entrenamiento personal</p>
        </div>
      </section>

      <!-- Resume Workout Card -->
      <div id="resumeWorkoutCard" class="hidden"></div>

      <!-- Quick Actions -->
      <section class="mb-6">
        <div class="grid grid-cols-4 gap-3">
          <button data-action="calculators" class="bg-dark-surface border border-dark-border rounded-xl p-3 flex flex-col items-center gap-2 active:scale-95 transition-transform">
            <i data-lucide="calculator" class="w-6 h-6 text-accent"></i>
            <span class="text-xs text-text-secondary">Calculadoras</span>
          </button>
          <button data-action="history" class="bg-dark-surface border border-dark-border rounded-xl p-3 flex flex-col items-center gap-2 active:scale-95 transition-transform">
            <i data-lucide="history" class="w-6 h-6 text-accent"></i>
            <span class="text-xs text-text-secondary">Historial</span>
          </button>
          <button data-action="charts" class="bg-dark-surface border border-dark-border rounded-xl p-3 flex flex-col items-center gap-2 active:scale-95 transition-transform">
            <i data-lucide="line-chart" class="w-6 h-6 text-accent"></i>
            <span class="text-xs text-text-secondary">Gráficos</span>
          </button>
          <button data-action="prs" class="bg-dark-surface border border-dark-border rounded-xl p-3 flex flex-col items-center gap-2 active:scale-95 transition-transform">
            <i data-lucide="trophy" class="w-6 h-6 text-status-warning"></i>
            <span class="text-xs text-text-secondary">PRs</span>
          </button>
        </div>
      </section>

      <!-- Rutinas -->
      <section class="mb-6">
        <h2 class="text-lg font-display font-bold text-text-primary mb-3 flex items-center gap-2">
          <i data-lucide="dumbbell" class="w-5 h-5 text-accent"></i>
          Rutinas Disponibles
        </h2>
        <div id="routinesContainer" class="space-y-3">
          <!-- Se renderiza dinámicamente -->
        </div>
      </section>

      <!-- Custom Workouts -->
      <div id="customWorkoutsContainer"></div>

      <!-- Cardio Section (Coming Soon) -->
      <section class="mt-6">
        <div class="w-full bg-dark-surface border border-dark-border rounded-xl p-4 flex items-center gap-4 opacity-50">
          <div class="w-12 h-12 rounded-lg bg-status-warning/10 flex items-center justify-center">
            <i data-lucide="flame" class="w-6 h-6 text-status-warning"></i>
          </div>
          <div class="flex-1 text-left">
            <h3 class="font-bold text-text-primary">Cardio & HIIT</h3>
            <p class="text-sm text-text-secondary">Próximamente</p>
          </div>
          <span class="text-xs text-text-muted bg-dark-bg px-2 py-1 rounded">Soon</span>
        </div>
      </section>
    </div>

    <!-- ==========================================
         WORKOUT TAB
         ========================================== -->
    <div id="workoutTab" class="tab-content hidden">
      <!-- Training Info -->
      <div id="trainingInfo" class="mb-4 hidden">
        <div class="flex items-center justify-between mb-2">
          <div>
            <h2 id="currentTraining" class="text-lg font-bold text-text-primary"></h2>
            <p id="currentDate" class="text-sm text-text-secondary"></p>
          </div>
          <button onclick="window.openRestTimerModal()" class="p-3 bg-dark-surface border border-dark-border rounded-xl active:scale-95 transition-transform">
            <i data-lucide="timer" class="w-5 h-5 text-accent"></i>
          </button>
        </div>
      </div>

      <!-- Quick Stats -->
      <div id="quickStats" class="hidden mb-4">
        <div class="grid grid-cols-4 gap-2">
          <div class="bg-dark-surface border border-dark-border rounded-xl p-3 text-center">
            <i data-lucide="trending-up" class="w-5 h-5 text-accent mx-auto mb-1"></i>
            <p id="statVolumen" class="text-lg font-bold text-accent">0</p>
            <p class="text-xs text-text-muted">Volumen</p>
          </div>
          <div class="bg-dark-surface border border-dark-border rounded-xl p-3 text-center">
            <i data-lucide="dumbbell" class="w-5 h-5 text-status-success mx-auto mb-1"></i>
            <p id="statEjercicios" class="text-lg font-bold text-status-success">0</p>
            <p class="text-xs text-text-muted">Ejercicios</p>
          </div>
          <div class="bg-dark-surface border border-dark-border rounded-xl p-3 text-center">
            <i data-lucide="check-circle" class="w-5 h-5 text-status-warning mx-auto mb-1"></i>
            <p id="statCompletados" class="text-lg font-bold text-status-warning">0/0</p>
            <p class="text-xs text-text-muted">Completados</p>
          </div>
          <div class="bg-dark-surface border border-dark-border rounded-xl p-3 text-center">
            <i data-lucide="layers" class="w-5 h-5 text-status-info mx-auto mb-1"></i>
            <p id="statSets" class="text-lg font-bold text-status-info">0</p>
            <p class="text-xs text-text-muted">Sets</p>
          </div>
        </div>
      </div>

      <!-- Ejercicios Container -->
      <div id="ejerciciosContainer" class="hidden">
        <div id="ejerciciosList"></div>
        <div id="opcionalesList" class="mt-4"></div>
      </div>

      <!-- Volume Summary -->
      <div id="volumeSummary" class="hidden mt-4">
        <div class="bg-dark-surface border border-dark-border rounded-xl p-4">
          <h3 class="text-sm font-semibold text-text-primary mb-3 flex items-center gap-2">
            <i data-lucide="bar-chart-3" class="w-4 h-4 text-accent"></i>
            Resumen de Volumen
          </h3>
          <div id="volumeBars"></div>
        </div>
      </div>

      <!-- Save Section -->
      <div id="saveSection" class="hidden mt-4 space-y-3">
        <button id="saveButton" onclick="window.saveWorkout()" class="w-full bg-accent hover:bg-accent-hover text-white font-semibold py-3 px-4 rounded-xl active:scale-95 transition-all flex items-center justify-center gap-2">
          <i data-lucide="save" class="w-5 h-5"></i>
          Guardar Entrenamiento
        </button>
        <button onclick="window.finishWorkout()" class="w-full bg-dark-surface border border-dark-border text-text-secondary font-semibold py-3 px-4 rounded-xl active:scale-95 transition-all flex items-center justify-center gap-2">
          <i data-lucide="flag" class="w-5 h-5"></i>
          Terminar Sesión
        </button>
        <p id="saveMessage" class="hidden text-center text-sm text-status-success py-2"></p>
      </div>
    </div>

    <!-- ==========================================
         CALCULATORS TAB
         ========================================== -->
    <div id="calculatorsTab" class="tab-content hidden">
      <h2 class="text-xl font-display font-bold text-text-primary mb-4 flex items-center gap-2">
        <i data-lucide="calculator" class="w-6 h-6 text-accent"></i>
        Calculadoras
      </h2>

      <!-- 1RM Calculator -->
      <div class="bg-dark-surface border border-dark-border rounded-xl p-4 mb-4">
        <h3 class="text-sm font-semibold text-text-primary mb-3 flex items-center gap-2">
          <i data-lucide="dumbbell" class="w-4 h-4 text-accent"></i>
          Calculadora de 1RM
        </h3>
        <select id="rm1ExerciseSelect" class="w-full mb-3">
          <option value="">-- Elige un ejercicio --</option>
        </select>
        <div id="rm1Results" class="hidden"></div>
      </div>

      <!-- Calories Calculator -->
      <div class="bg-dark-surface border border-dark-border rounded-xl p-4 mb-4">
        <h3 class="text-sm font-semibold text-text-primary mb-3 flex items-center gap-2">
          <i data-lucide="flame" class="w-4 h-4 text-status-warning"></i>
          Calculadora de Calorías
        </h3>
        <div class="space-y-3">
          <div class="flex gap-2">
            <input type="number" id="caloriesAge" placeholder="Edad" class="flex-1" />
            <select id="caloriesGender" class="flex-1">
              <option value="male">Masculino</option>
              <option value="female">Femenino</option>
            </select>
          </div>
          <div class="flex gap-2">
            <input type="number" id="caloriesWeight" placeholder="Peso (kg)" class="flex-1" />
            <input type="number" id="caloriesHeight" placeholder="Altura (cm)" class="flex-1" />
          </div>
          <select id="caloriesActivity" class="w-full">
            <option value="1.2">Sedentario (poco o nada de ejercicio)</option>
            <option value="1.375">Ligero (1-3 días/semana)</option>
            <option value="1.55">Moderado (3-5 días/semana)</option>
            <option value="1.725">Activo (6-7 días/semana)</option>
            <option value="1.9">Muy activo (atleta, trabajo físico)</option>
          </select>
          <div class="flex gap-2">
            <button id="prefillFromProfile" class="flex-1 py-2 px-4 bg-dark-bg border border-dark-border rounded-lg text-text-secondary text-sm active:scale-95 transition-all flex items-center justify-center gap-2">
              <i data-lucide="user" class="w-4 h-4"></i>
              Usar perfil
            </button>
            <button id="calculateCaloriesBtn" class="flex-1 py-2 px-4 bg-accent text-white rounded-lg font-semibold text-sm active:scale-95 transition-all">
              Calcular
            </button>
          </div>
        </div>
        <div id="caloriesResults" class="hidden mt-4"></div>
      </div>

      <!-- Progressive Calculator -->
      <div class="bg-dark-surface border border-dark-border rounded-xl p-4">
        <h3 class="text-sm font-semibold text-text-primary mb-3 flex items-center gap-2">
          <i data-lucide="trending-up" class="w-4 h-4 text-status-success"></i>
          Peso Progresivo
        </h3>
        <select id="progressiveExerciseSelect" class="w-full mb-3">
          <option value="">-- Elige un ejercicio --</option>
        </select>
        <div id="progressiveResults" class="hidden"></div>
      </div>
    </div>

    <!-- ==========================================
         CHARTS TAB
         ========================================== -->
    <div id="chartsTab" class="tab-content hidden">
      <h2 class="text-xl font-display font-bold text-text-primary mb-4 flex items-center gap-2">
        <i data-lucide="line-chart" class="w-6 h-6 text-accent"></i>
        Progreso
      </h2>

      <!-- Volume Trend -->
      <div class="bg-dark-surface border border-dark-border rounded-xl p-4 mb-4">
        <h3 class="text-sm font-semibold text-text-primary mb-3">Tendencia de Volumen</h3>
        <div class="h-48">
          <canvas id="volumeTrendChart"></canvas>
        </div>
      </div>

      <!-- Muscle Distribution -->
      <div class="bg-dark-surface border border-dark-border rounded-xl p-4 mb-4">
        <h3 class="text-sm font-semibold text-text-primary mb-3">Distribución Muscular</h3>
        <div class="h-48">
          <canvas id="muscleDistributionChart"></canvas>
        </div>
      </div>

      <!-- Weight Progress -->
      <div class="bg-dark-surface border border-dark-border rounded-xl p-4 mb-4">
        <h3 class="text-sm font-semibold text-text-primary mb-3">Progreso por Ejercicio</h3>
        <select id="exerciseChartSelect" class="w-full mb-3">
          <option value="">-- Elige un ejercicio --</option>
        </select>
        <div class="h-48">
          <canvas id="weightProgressChart"></canvas>
        </div>
      </div>

      <!-- Weekly Comparison -->
      <div class="bg-dark-surface border border-dark-border rounded-xl p-4">
        <h3 class="text-sm font-semibold text-text-primary mb-3">Volumen Semanal</h3>
        <div class="h-48">
          <canvas id="weeklyComparisonChart"></canvas>
        </div>
      </div>
    </div>

    <!-- ==========================================
         HISTORY TAB
         ========================================== -->
    <div id="historyTab" class="tab-content hidden">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-display font-bold text-text-primary flex items-center gap-2">
          <i data-lucide="history" class="w-6 h-6 text-accent"></i>
          Historial
        </h2>
        <button onclick="window.exportToExcel()" class="px-3 py-2 bg-dark-surface border border-dark-border rounded-lg text-text-secondary text-sm active:scale-95 transition-all flex items-center gap-2">
          <i data-lucide="download" class="w-4 h-4"></i>
          Exportar
        </button>
      </div>
      <div id="historyList" class="space-y-3"></div>
    </div>

    <!-- ==========================================
         PRS TAB
         ========================================== -->
    <div id="prsTab" class="tab-content hidden">
      <h2 class="text-xl font-display font-bold text-text-primary mb-4 flex items-center gap-2">
        <i data-lucide="trophy" class="w-6 h-6 text-status-warning"></i>
        Personal Records
      </h2>
      <div id="prsList" class="space-y-3"></div>
    </div>

    <!-- ==========================================
         PROFILE TAB
         ========================================== -->
    <div id="profileTab" class="tab-content hidden">
      <h2 class="text-xl font-display font-bold text-text-primary mb-4 flex items-center gap-2">
        <i data-lucide="user" class="w-6 h-6 text-accent"></i>
        Mi Perfil
      </h2>

      <form id="profileForm" class="bg-dark-surface border border-dark-border rounded-xl p-4">
        <div class="space-y-4">
          <div>
            <label class="block text-sm text-text-secondary mb-1">Nombre</label>
            <input type="text" id="profileName" placeholder="Tu nombre" class="w-full" />
          </div>
          <div>
            <label class="block text-sm text-text-secondary mb-1">Fecha de nacimiento</label>
            <input type="date" id="profileBirthdate" class="w-full" />
            <p class="text-xs text-text-muted mt-1">Edad: <span id="calculatedAge">-</span> años</p>
          </div>
          <div>
            <label class="block text-sm text-text-secondary mb-1">Género</label>
            <select id="profileGender" class="w-full">
              <option value="male">Masculino</option>
              <option value="female">Femenino</option>
            </select>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div>
              <label class="block text-sm text-text-secondary mb-1">Peso (kg)</label>
              <input type="number" id="profileWeight" placeholder="70" class="w-full" />
            </div>
            <div>
              <label class="block text-sm text-text-secondary mb-1">Altura (cm)</label>
              <input type="number" id="profileHeight" placeholder="175" class="w-full" />
            </div>
          </div>
          <div>
            <label class="block text-sm text-text-secondary mb-1">Nivel de actividad</label>
            <select id="profileActivity" class="w-full">
              <option value="1.2">Sedentario</option>
              <option value="1.375">Ligero (1-3 días/semana)</option>
              <option value="1.55">Moderado (3-5 días/semana)</option>
              <option value="1.725">Activo (6-7 días/semana)</option>
              <option value="1.9">Muy activo</option>
            </select>
          </div>
          <button type="submit" class="w-full bg-accent hover:bg-accent-hover text-white font-semibold py-3 px-4 rounded-xl active:scale-95 transition-all flex items-center justify-center gap-2">
            <i data-lucide="save" class="w-5 h-5"></i>
            Guardar Perfil
          </button>
          <p id="profileSaveMessage" class="hidden text-center text-sm text-status-success py-2">
            Perfil guardado correctamente
          </p>
        </div>
      </form>
    </div>

  </main>

  <!-- ==========================================
       BOTTOM NAVIGATION
       ========================================== -->
  <nav class="bottom-nav">
    <div class="flex items-center justify-around">
      <div data-nav="home" class="bottom-nav-item active">
        <i data-lucide="home" class="w-5 h-5"></i>
        <span>Inicio</span>
      </div>
      <div data-nav="calculators" class="bottom-nav-item">
        <i data-lucide="calculator" class="w-5 h-5"></i>
        <span>Calc</span>
      </div>
      <div id="fabButton" class="fab-button">
        <i data-lucide="plus" class="w-6 h-6 text-white"></i>
      </div>
      <div data-nav="history" class="bottom-nav-item">
        <i data-lucide="history" class="w-5 h-5"></i>
        <span>Historial</span>
      </div>
      <div data-nav="profile" class="bottom-nav-item">
        <i data-lucide="user" class="w-5 h-5"></i>
        <span>Perfil</span>
      </div>
    </div>
  </nav>

  <!-- ==========================================
       MODALS
       ========================================== -->

  <!-- Animation Modal -->
  <div id="animationModal" class="modal">
    <div class="modal-content p-4">
      <div class="flex items-center justify-between mb-4">
        <h3 id="modalTitle" class="font-bold text-text-primary"></h3>
        <button id="closeModal" class="p-2 text-text-muted hover:text-text-primary">
          <i data-lucide="x" class="w-5 h-5"></i>
        </button>
      </div>
      <div id="animationContainer" class="flex items-center justify-center min-h-[200px]">
        <p class="text-text-secondary">Cargando imagen de referencia...</p>
      </div>
    </div>
  </div>

  <!-- Rest Timer Modal -->
  <div id="restTimerModal" class="modal">
    <div class="modal-content p-4">
      <div class="flex items-center justify-between mb-4">
        <h3 class="font-bold text-text-primary flex items-center gap-2">
          <i data-lucide="timer" class="w-5 h-5 text-accent"></i>
          Tiempo de Descanso
        </h3>
        <button id="closeRestModal" class="p-2 text-text-muted hover:text-text-primary">
          <i data-lucide="x" class="w-5 h-5"></i>
        </button>
      </div>
      <div class="grid grid-cols-3 gap-3">
        <button data-seconds="30" class="rest-time-btn py-4 bg-dark-bg border border-dark-border rounded-xl text-center active:scale-95 transition-transform">
          <p class="text-xl font-bold text-accent">30s</p>
          <p class="text-xs text-text-muted">Rápido</p>
        </button>
        <button data-seconds="60" class="rest-time-btn py-4 bg-dark-bg border border-dark-border rounded-xl text-center active:scale-95 transition-transform">
          <p class="text-xl font-bold text-accent">1:00</p>
          <p class="text-xs text-text-muted">Normal</p>
        </button>
        <button data-seconds="90" class="rest-time-btn py-4 bg-dark-bg border border-dark-border rounded-xl text-center active:scale-95 transition-transform">
          <p class="text-xl font-bold text-accent">1:30</p>
          <p class="text-xs text-text-muted">Largo</p>
        </button>
        <button data-seconds="120" class="rest-time-btn py-4 bg-dark-bg border border-dark-border rounded-xl text-center active:scale-95 transition-transform">
          <p class="text-xl font-bold text-accent">2:00</p>
          <p class="text-xs text-text-muted">Pesado</p>
        </button>
        <button data-seconds="180" class="rest-time-btn py-4 bg-dark-bg border border-dark-border rounded-xl text-center active:scale-95 transition-transform">
          <p class="text-xl font-bold text-accent">3:00</p>
          <p class="text-xs text-text-muted">Fuerza</p>
        </button>
        <button data-seconds="300" class="rest-time-btn py-4 bg-dark-bg border border-dark-border rounded-xl text-center active:scale-95 transition-transform">
          <p class="text-xl font-bold text-accent">5:00</p>
          <p class="text-xs text-text-muted">Máximo</p>
        </button>
      </div>
    </div>
  </div>

  <script type="module" src="/src/main.ts"></script>
</body>
</html>
